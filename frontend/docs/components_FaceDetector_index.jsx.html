<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/FaceDetector/index.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/FaceDetector/index.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {useEffect, useRef, useState} from 'react';
import axios from 'axios';
import Eye from "./Eye";
import '../../styles/FaceDetector.css';

/**
 * FaceDetector component is used to detect faces in the video stream and send the video frame data to the Flask backend.
 * @returns {JSX.Element}
 * @component
 */
const FaceDetector = () => {
    const videoRef = useRef(null);
    const canvasRef = useRef(null);
    const [detected, setDetected] = useState(false);
    const speech = new SpeechSynthesisUtterance();


    const log = (...args) => {
        console.log(...args);
    };

    useEffect(() => {
        const run = async () => {
            log("run started");
            speech.voice = speechSynthesis.getVoices()[5];
            speech.lang = "en-US";


        };

        run().then(startVideo);

    }, []);


    const talkToUser = () => {
        speech.text = "hello";
        speechSynthesis.speak(speech);
    };

    const startVideo = async () => {
        navigator.mediaDevices.getUserMedia({video: true})
            .then((stream) => {
                videoRef.current.srcObject = stream;
            })
            .catch((err) => {
                console.error(err);
            });
    };

    /**
     * Detects faces in the video stream and sends the video frame data to the Flask backend
     * @returns {Promise&lt;void>}
     */
    const detectFace = async () => {

        if (videoRef.current.paused || videoRef.current.ended) {
            setTimeout(() => detectFace());
            return;
        }

        const video = videoRef.current;
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Convert the canvas to base64-encoded data
        const frameData = canvas.toDataURL('image/jpeg', 0.8);

        // Send the video frame data to the Flask backend
        const response = await fetch('http://localhost:5000/recognize_face', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({frame_data: frameData}),
        });

        const data = await response.json();
        console.log(data.name);

        setTimeout(() => detectFace(), 1000);
    };

    return (

        &lt;div className="ui basic center aligned segment video-container"
             style={{margin: "auto", width: "fit-content", maxWidth: "600px"}}>
            &lt;div className="circle">
                &lt;span className="circle__btn">
                    &lt;video
                        id={"face-recognition-video-cam"}
                        ref={videoRef}
                        autoPlay
                        onPlay={detectFace}
                        style={{display: "block"}}

                    />
                    &lt;canvas ref={canvasRef}/>
                    {/*&lt;Eye/>*/}
                &lt;/span>

                &lt;span className="circle__back-1">&lt;/span>
                &lt;span className="circle__back-2">&lt;/span>

            &lt;/div>

        &lt;/div>
    );
};


export default FaceDetector;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#ContactList">ContactList</a></li><li><a href="global.html#Controls">Controls</a></li><li><a href="global.html#Eye">Eye</a></li><li><a href="global.html#FaceDetector">FaceDetector</a></li><li><a href="global.html#JoinScreen">JoinScreen</a></li><li><a href="global.html#MeetingView">MeetingView</a></li><li><a href="global.html#ParticipantView">ParticipantView</a></li><li><a href="global.html#VideoCall">VideoCall</a></li><li><a href="global.html#VideoCallPopup">VideoCallPopup</a></li><li><a href="global.html#createMeeting">createMeeting</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Apr 19 2023 16:32:10 GMT+0300 (Israel Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
